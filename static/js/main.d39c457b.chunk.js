(this["webpackJsonpcompartmental-model-simulator"]=this["webpackJsonpcompartmental-model-simulator"]||[]).push([[0],{109:function(a,e,t){"use strict";t.r(e);var r=t(5),i=t(0),n=t.n(i),o=t(11),l=t.n(o),s=(t(89),t(51)),c=t(32),d=t(22),h=t(16),u=t(66),f=t(65),m=(t.p,t(55),t(156)),g=t(160),b=t(159),w=t(154),R=t(157),x=t(158),k=t(155),v=t(147),p=t(4),M=t(151),S=t(168),j=t(153),y=t(152),C=Object(v.a)({root:{width:250},input:{width:100}}),_=Object(p.a)({thumb:{backgroundColor:"#ffffff",border:"3px solid currentColor"},active:{}})(S.a);function O(a,e){if(0==a)return 0;var t=Math.ceil(Math.log10(a<0?-a:a)),r=e-Math.floor(t),i=Math.pow(10,r);return Math.round(a*i)/i}function L(a){var e=a.steps,t=a.min,i=a.max,n=a.color,o=a.log,l=a.type,s=a.index,c=a.value,d=a.sliderChangedCallback,h=a.sliderLogToggledCallback,u=a.disabled,f=C();c="number"===typeof c?c:0,o&&(t=t<=0?1e-6*i:t);var m=(i-t)/e,g=(Math.log(i)-Math.log(t))/e,b=o?Math.exp(Math.log(c)+g)-c:m;return b=O(b,3),Object(r.jsx)("div",{children:Object(r.jsxs)(M.a,{container:!0,spacing:2,alignItems:"center",children:[Object(r.jsx)(M.a,{item:!0,xs:!0,children:Object(r.jsx)(y.a,{selected:o,disabled:u,onChange:function(){return h(l,s)},children:"Log"})}),Object(r.jsx)(M.a,{item:!0,xs:!0,children:Object(r.jsx)(_,{value:o?Math.log(c):c,onChange:function(a,e){if(c!==e){var t=!0===o?Math.exp(e):e;d(l,s,O(t,3))}},"aria-labelledby":"input-slider",min:o?Math.log(t):t,max:o?Math.log(i):i,step:o?g:m,color:n,disabled:u})}),Object(r.jsx)(M.a,{item:!0,children:Object(r.jsx)(j.a,{value:c,margin:"dense",className:f.input,onChange:function(a){var e=""===a.target.value?0:Number(a.target.value);c!==e&&d(l,s,O(e,3))},inputProps:{min:t,max:i,step:b,type:"number","aria-labelledby":"input-slider"},disabled:u})})]})})}var B=t(31);t(49);function E(a){var e=a.data,t=a.sliderChangedCallback,i=a.sliderLogToggledCallback;return Object(r.jsx)(w.a,{component:k.a,children:Object(r.jsxs)(m.a,{size:"small","aria-label":"simple table",children:[Object(r.jsx)(R.a,{children:Object(r.jsxs)(x.a,{children:[Object(r.jsx)(b.a,{align:"center",children:"Compartment"}),Object(r.jsx)(b.a,{align:"center",children:"Initial conditions"})]})}),Object(r.jsx)(g.a,{children:e.map((function(a,e){return Object(r.jsxs)(x.a,{children:[Object(r.jsx)(b.a,{align:"center",children:Object(r.jsx)(B.InlineMath,{math:a.texName,errorColor:"#cc0000"})}),Object(r.jsx)(b.a,{align:"center",children:Object(r.jsx)(L,{log:a.log,steps:100,min:a.min,max:a.max,value:a.init,type:"init",index:e,color:"primary",sliderChangedCallback:t,sliderLogToggledCallback:i})})]})}))})]})})}function T(a){var e=a.data,t=a.disabled,i=a.sliderChangedCallback,n=a.sliderLogToggledCallback;return Object(r.jsx)(w.a,{component:k.a,children:Object(r.jsxs)(m.a,{size:"small","aria-label":"simple table",children:[Object(r.jsx)(R.a,{children:Object(r.jsxs)(x.a,{children:[Object(r.jsx)(b.a,{align:"center",children:"Rate constant"}),Object(r.jsx)(b.a,{align:"center",children:"Forward rates"}),Object(r.jsx)(b.a,{align:"center",children:"Backward rates"})]})}),Object(r.jsx)(g.a,{children:e.map((function(a,e){return Object(r.jsxs)(x.a,{children:[Object(r.jsx)(b.a,{align:"center",children:Object(r.jsx)(B.InlineMath,{math:a.texName,errorColor:"#cc0000"})}),Object(r.jsx)(b.a,{align:"center",children:Object(r.jsx)(L,{log:a.log_fr,steps:100,min:a.min_fr,max:a.max_fr,value:a.fr,type:"fr",index:e,sliderChangedCallback:i,sliderLogToggledCallback:n,color:"primary"})}),Object(r.jsx)(b.a,{align:"center",children:Object(r.jsx)(L,{log:a.log_br,steps:100,min:a.min_br,max:a.max_br,value:a.br,type:"br",index:e,sliderChangedCallback:i,sliderLogToggledCallback:n,disabled:t,color:"secondary"})})]})}))})]})})}var D=t(111),A=t(161);function I(a){var e=a.schemeText,t=a.modelSubmitCallback,i=a.textChangedCallback;return Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:"text-area",children:Object(r.jsx)(D.a,{onChange:function(a){return i(a.target.value)},"aria-label":"empty textarea",placeholder:">> Place kinetic model here <<",style:{fontSize:18,fontFamily:"Palatino"},value:e})}),Object(r.jsx)(A.a,{variant:"contained",onClick:function(){return t()},color:"primary",children:"Submit"})]})}var N=t(62);new Error("The destination of the undependent variable has to be greater than its start");var F=t(95);Array.prototype.equals&&console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code."),Array.prototype.equals=function(a){if(!a)return!1;if(this.length!==a.length)return!1;for(var e=0,t=this.length;e<t;e++)if(this[e]instanceof Array&&a[e]instanceof Array){if(!this[e].equals(a[e]))return!1}else if(this[e]!==a[e])return!1;return!0},Object.defineProperty(Array.prototype,"equals",{enumerable:!1});var Z=function(){function a(){Object(c.a)(this,a),this.initial_conditions={},this.elem_reactions=[],this.scheme="",this.func=null,this.diffEquations="",this.diffEquationsFRates="",this.latexModel="",this.latexModelFRates=""}return Object(d.a)(a,[{key:"addElementaryReaction",value:function(){for(var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["A","A"],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["B","C"],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n={from_comp:a,to_comp:e,forward_rate:t,backward_rate:r,comment:i},o=0;o<this.elem_reactions.length;o++){var l=this.elem_reactions[o];if(l.from_comp.equals(n.from_comp)&&l.to_comp.equals(n.to_comp))return l.forward_rate=n.forward_rate,void(l.backward_rate=n.backward_rate)}this.elem_reactions.push(n)}},{key:"getCompartments",value:function(){var a=[];return this.elem_reactions.forEach((function(e){e.from_comp.forEach((function(e){a.includes(e)||a.push(e)})),e.to_comp.forEach((function(e){a.includes(e)||a.push(e)}))})),a}},{key:"getLatexFormattedCompartments",value:function(){var a,e=[],t=Object(N.a)(this.getCompartments());try{for(t.s();!(a=t.n()).done;){var r=a.value;e.push("\\mathrm{".concat(r.replaceAll(".","{\\Large\\cdot}"),"}"))}}catch(i){t.e(i)}finally{t.f()}return e}},{key:"getRateNames",value:function(){for(var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=[],r=0;r<this.elem_reactions.length;r++){var i=e?"k_{".concat(r+1,"}"):"{\\color{blue}k_{".concat(r+1,"}}"),n=e?"k_{-".concat(r+1,"}"):"{\\color{red}k_{-".concat(r+1,"}}");t.push(a?[i,n]:i)}return t}},{key:"_buildLatexModel",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getCompartments(),r=this.getLatexFormattedCompartments(),i={},n=this.getRateNames(e),o=0;o<t.length+1;o++)i[t[o]]=r[o];for(var l=[],s=0;s<this.elem_reactions.length;s++){var c=this.elem_reactions[s],d=c.from_comp.map((function(a){return i[a]})),h=c.to_comp.map((function(a){return i[a]})),u=a.occurences(d),f=a.occurences(h);for(var m in d=[],h=[],u){var g=u[m];d.push(1===g?m:"".concat(g,"\\ ").concat(m))}for(var b in f){var w=f[b];h.push(1===w?b:"".concat(w,"\\ ").concat(b))}var R="&\\xrightleftharpoons[".concat(n[s][1],"]{\\hspace{0.1cm}").concat(n[s][0],"\\hspace{0.1cm}}"),x="&\\xrightarrow{\\hspace{0.1cm}".concat(n[s],"\\hspace{0.1cm}}"),k=""===c.comment?"":"&& {\\color{green}\\text{\\textit{".concat(c.comment,"}}}"),v="".concat(d.join("+"),"  ").concat(e?R:x," ").concat(h.join("+")," ").concat(k);l.push(v)}var p="\\begin{aligned} ".concat(l.join("\\\\")," \\end{aligned}");return p}},{key:"printModel",value:function(){console.log("Scheme: ".concat(this.scheme)),console.log("Initial conditions:",this.initial_conditions),this.elem_reactions.forEach((function(a){console.log("Elementary reaction: ".concat(a.from_comp.join(" + ")," -> ").concat(a.to_comp.join(" + "),", forward_rate=").concat(a.forward_rate,", backward_rate=").concat(a.backward_rate))}))}},{key:"simulateModel",value:function(){for(var a=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,100],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object.values(this.initial_conditions),i=new Array(this.elem_reactions.length),n=new Array(this.elem_reactions.length),o=0;o<this.elem_reactions.length;o++)i[o]=this.elem_reactions[o].forward_rate,n[o]=t?0:this.elem_reactions[o].backward_rate;var l=new F.System;return l.setStart(e[0]),l.setStop(e[1]),l.setInitX(r),l.setH(.1),l.setFn((function(e,t){return a.func(e,t,i,n)})),l.solve(),l.result}},{key:"_buildDiffEq",value:function(e,t){for(var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.getRateNames(!0),n=this.getLatexFormattedCompartments(),o=n.length,l=new Array(o),s=new Array(o),c=0;c<o;c++)l[c]=[],s[c]=[];for(var d=function(o){var c=i[o][0],d=i[o][1],h=e[o].map((function(a){return"[".concat(n[a],"]")})),u=t[o].map((function(a){return"[".concat(n[a],"]")})),f=a.occurences(h),m=a.occurences(u);for(var g in f){var b=f[g];c+=1===b?g:"".concat(g,"^{").concat(b,"}")}for(var w in m){var R=m[w];d+=1===R?w:"".concat(w,"^{").concat(R,"}")}e[o].forEach((function(a){r&&l[a].push(d),s[a].push(c)})),t[o].forEach((function(a){l[a].push(c),r&&s[a].push(d)}))},h=0;h<this.elem_reactions.length;h++)d(h);for(var u=[],f=0;f<o;f++){var m=a.occurences(l[f]),g=a.occurences(s[f],m,!0),b=[];for(var w in g){var R=g[w];if(0!==R){var x=R>0?"+":"-",k=1===Math.abs(R)?"":Math.abs(R);b.push("".concat(x).concat(k).concat(w))}}u.push("\\frac{\\mathrm d[".concat(n[f],"]}{\\mathrm dt}&=").concat(b.join("")))}return"\\begin{aligned} ".concat(u.join("\\\\")," \\end{aligned}")}},{key:"buildFunc",value:function(){for(var a=this.getCompartments(),e=a.length,t={},r=0;r<e;r++)t[a[r]]=r;for(var i=this.elem_reactions.length,n=[],o=[],l=[],s=[],c=0;c<i;c++){var d=this.elem_reactions[c],h=d.from_comp.map((function(a){return t[a]})),u=d.to_comp.map((function(a){return t[a]}));n.push(h),o.push(u),l[c]=d.forward_rate,s[c]=d.backward_rate}this.diffEquations=this._buildDiffEq(n,o,!0),this.diffEquationsFRates=this._buildDiffEq(n,o,!1),this.latexModel=this._buildLatexModel(!0),this.latexModelFRates=this._buildLatexModel(!1),this.func=function(a,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null==r&&(r=l),null==c&&(c=s);for(var d=new Array(e).fill(0),h=0;h<i;h++){for(var u=r[h],f=c[h],m=0;m<n[h].length;m++)u*=t[n[h][m]];for(var g=0;g<o[h].length;g++)f*=t[o[h][g]];for(var b=0;b<n[h].length;b++)d[n[h][b]]+=f-u;for(var w=0;w<o[h].length;w++)d[o[h][w]]+=u-f}return d}}}],[{key:"occurences",value:function(a){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=null===e?{}:e;for(var r=t?-1:1,i=0;i<a.length;i++){var n=a[i];e[n]=e[n]?e[n]+r:r}return e}},{key:"fromText",value:function(e){var t=new a;t.scheme=e,e.split("\n").forEach((function(a){var e=a.split("//");a=e[0];var r=2==e.length?e[1]:"";r=r.trim();var i=a.match(/[^\s]+/g);if(""!==a&&null!==i){a=i.join("");var n=[];a.split("=").forEach((function(a){for(var e=[],t=[],r=0;r<a.length;r++)"+"===a[r]&&"^"!==a[r-1]&&"_"!==a[r-1]&&t.push(r);for(var i,o=/{[^{}]*\+[^{}]*}/g,l="".concat(a);i=o.exec(l);)for(var s=!0,c=i.index,d=c+i[0].length-1;s;){s=!1;for(r=0;r<=t.length;r++)if(t[r]>c&&t[r]<d){t.splice(r,1),s=!0;break}}var h=[],u=0;for(r=0;r<t.length;r++)h.push(a.substring(u,t[r])),u=t[r]+1;h.push(a.substring(u,a.length)),h.forEach((function(a){for(var t=/^(\d+).+/g.exec(a),r=null!=t,i=r?parseInt(t[1]):1,n=r?a.substring(t[1].length):a,o=0;o<i;o++)e.push(n)})),n.push(e)}));for(var o=0;o<n.length-1;o++)t.addElementaryReaction(n[o],n[o+1],1,0,r)}}));for(var r=t.getCompartments(),i=0;i<r.length;i++)t.initial_conditions[r[i]]=0===i?1:0;return t}}]),a}(),q=t(166),P=t(167),X=t(165),H=t(164),z=[{class:"Funny models",name:"Cyclic model",description:"",scheme:"A = B = C = D = E = F = G = H = I = J = K = A",nonZeroBackwardRates:!1,initialConditions:{A:{logSlider:!1,min:0,max:50,value:1},B:{logSlider:!1,min:0,max:50,value:0},C:{logSlider:!1,min:0,max:50,value:0},D:{logSlider:!1,min:0,max:50,value:0},E:{logSlider:!1,min:0,max:50,value:0},F:{logSlider:!1,min:0,max:50,value:0},G:{logSlider:!1,min:0,max:50,value:0},H:{logSlider:!1,min:0,max:50,value:0},I:{logSlider:!1,min:0,max:50,value:0},J:{logSlider:!1,min:0,max:50,value:0},K:{logSlider:!1,min:0,max:50,value:0}}},{class:"Funny models",name:"Lotka-Volterra",description:"",scheme:"Rabbit = 2Rabbit\nWolf = DeadWolf\nWolf + Rabbit = 2Wolf",nonZeroBackwardRates:!1,initialConditions:{Rabbit:{logSlider:!1,min:0,max:50,value:1},Wolf:{logSlider:!1,min:0,max:50,value:1},DeadWolf:{logSlider:!1,min:0,max:50,value:0}},rates:[{forwardRate:4.4,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:1.9,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:1.3,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1}]},{class:"Epidemic",name:"SIR Model",description:"TODO",scheme:"Susceptible + Infected = 2Infected\nInfected = Recovered\nInfected = Dead",nonZeroBackwardRates:!1,initialConditions:{Susceptible:{logSlider:!1,min:0,max:100,value:10},Infected:{logSlider:!0,min:1e-5,max:10,value:.001},Recovered:{logSlider:!1,min:0,max:10,value:0},Dead:{logSlider:!1,min:0,max:10,value:0}},rates:[{forwardRate:.6,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:1.5,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.1,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1}]},{class:"Epidemic",name:"SEIRS Model",description:"TODO",scheme:"Susceptible + Infected = Exposed + Infected\nExposed = Infected = Recovered = Susceptible\nInfected = Dead",nonZeroBackwardRates:!1,initialConditions:{Susceptible:{logSlider:!1,min:0,max:100,value:10},Exposed:{logSlider:!1,min:0,max:100,value:0},Infected:{logSlider:!0,min:1e-5,max:10,value:1e-4},Recovered:{logSlider:!1,min:0,max:10,value:0},Dead:{logSlider:!1,min:0,max:10,value:0}},rates:[{forwardRate:4,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.8,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:2.4,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.3,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.1,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1}]},{class:"Chemical kinetics",name:"Michaelis-Menten",description:"TODO",scheme:"E + S = ES = E + P",nonZeroBackwardRates:!0,initialConditions:{E:{logSlider:!1,min:0,max:50,value:3.5},S:{logSlider:!1,min:0,max:50,value:10},ES:{logSlider:!1,min:0,max:50,value:0},P:{logSlider:!1,min:0,max:50,value:0}},rates:[{forwardRate:.4,backwardRate:1.4,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:1.9,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1}]},{class:"Chemical kinetics",name:"H2 + Br2",description:"TODO",scheme:"Br2 = 2Br.\nBr. + H2 = HBr + H.\nH. + Br2 = HBr + Br.",nonZeroBackwardRates:!0,initialConditions:{Br2:{logSlider:!1,min:0,max:50,value:1},"Br.":{logSlider:!1,min:0,max:50,value:0},H2:{logSlider:!1,min:0,max:50,value:1},HBr:{logSlider:!1,min:0,max:50,value:0},"H.":{logSlider:!1,min:0,max:50,value:0}},rates:[{forwardRate:.4,backwardRate:.9,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:2.9,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:1.2,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1}]},{class:"Photochemistry",name:"Photosensitization",description:"TODO",scheme:"^3PS = PS // Triplet state decay of sensitizer\n2^3PS = ^3PS + PS // Triplet-triplet annihilation\nS + ^3PS = ^3S + PS // Energy transfer to substrate\n^3S = S // Triplet state decay of substrate\n2^3S = ^3S + S // Triplet-triplet annihilation",nonZeroBackwardRates:!1,initialConditions:{"^3PS":{logSlider:!1,min:0,max:50,value:1},PS:{logSlider:!1,min:0,max:50,value:0},S:{logSlider:!1,min:0,max:50,value:2},"^3S":{logSlider:!1,min:0,max:50,value:0}},rates:[{forwardRate:.5,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.3,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:1,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.5,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.1,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1}]},{class:"Photochemistry",name:"Rose bengal kinetics",description:"TODO",scheme:"^1RB^{2-*} = ^3RB^{2-*} // Intersystem crossing\n^1RB^{2-*} = RB^{2-} // Singlet state decay (internal conversion and fluorescence)\n^3RB^{2-*} = RB^{2-} // Triplet state decay (internal conversion and phosphorescence)\n^3RB^{2-*} + RB^{2-} = 2RB^{2-} // Self-quenching\n2^3RB^{2-*} = ^1RB^{2-*} + RB^{2-} // Triplet-triplet annihilation\n^3RB^{2-*} + RB^{2-} = RB^{.-} + RB^{.3-} // Electron transfer\n2^3RB^{2-*} = RB^{.-} + RB^{.3-} // Disproportionation\nRB^{.-} + RB^{.3-} = 2RB^{2-} // Back electron transfer",nonZeroBackwardRates:!1,initialConditions:{"^1RB^{2-*}":{logSlider:!1,min:0,max:50,value:1},"^3RB^{2-*}":{logSlider:!1,min:0,max:50,value:0},"RB^{2-}":{logSlider:!1,min:0,max:50,value:0},"RB^{.-}":{logSlider:!1,min:0,max:50,value:0},"RB^{.3-}":{logSlider:!1,min:0,max:50,value:0}},rates:[{forwardRate:10,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:2,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:1.01,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.6,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:1.2,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:.2,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:2.4,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1},{forwardRate:4.5,backwardRate:0,forwardRateMin:0,forwardRateMax:10,backwardRateMin:0,backwardRateMax:10,forwardRateLogSlider:!1,backwardRateLogSlider:!1}]}],V=t(63),W=t.n(V);function K(a){var e=a.data,t=a.layout,i=a.config,n=a.frames,o=a.revision;return Object(r.jsx)(W.a,{data:e,layout:t,config:i,frames:n,revision:o,useResizeHandler:!0,style:{width:"100%",height:"100%"}})}var J=function(a){Object(u.a)(t,a);var e=Object(f.a)(t);function t(){var a;return Object(c.a)(this,t),(a=e.call(this)).state={initData:[],ratesData:[],schemeText:"A = B = C = D = E",figure:{data:[],layout:{xaxis:{title:"Time",showgrid:!0,zeroline:!1,linecolor:"black",type:"linear",linewidth:2,mirror:!0},yaxis:{title:"Concentration",showgrid:!0,zeroline:!1,type:"linear",linecolor:"black",linewidth:2,mirror:!0},autosize:!0},frames:[],config:{scrollZoom:!0,responsive:!1},revision:0},texEquation:"",texModel:"",cbNonZero:!1},a.model=null,a.modelSubmitted=a.modelSubmitted.bind(Object(h.a)(a)),a.sliderValueChanged=a.sliderValueChanged.bind(Object(h.a)(a)),a.cbNonZero_checkedChanged=a.cbNonZero_checkedChanged.bind(Object(h.a)(a)),a.textChangedCallback=a.textChangedCallback.bind(Object(h.a)(a)),a.sliderLogToggledCallback=a.sliderLogToggledCallback.bind(Object(h.a)(a)),a.modelChanged=a.modelChanged.bind(Object(h.a)(a)),a}return Object(d.a)(t,[{key:"componentDidMount",value:function(){this.modelSubmitted()}},{key:"simulModel",value:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[0,10],t=200,r=this.model.getCompartments(),i=this.model.simulateModel(t,e,a),n=this.state.figure,o=r.length-n.data.length;if(o>0)for(var l=0;l<o;l++)n.data.push({x:[],y:[],mode:"lines",type:"scatter",name:""});else if(o<0)for(var s=0;s<-o;s++)n.data.pop();for(var c=0;c<r.length;c++)n.data[c].x=i.xVals,n.data[c].y=i.yVals[c],n.data[c].name="".concat(r[c]);return n.revision+=1,n}},{key:"textChangedCallback",value:function(a){this.setState({schemeText:a})}},{key:"modelSubmitted",value:function(a){var e=this.state.schemeText;if(""!==e&&null!==e.match(/[^\s]+/g)){var t=this.state.initData,r=this.state.ratesData;this.model=Z.fromText(e);for(var i=this.model.getCompartments(),n=this.model.getLatexFormattedCompartments(),o=this.model.getRateNames(!1,!0),l=new Array(i.length),s=0;s<l.length;s++){var c=s<t.length?t[s].init:this.model.initial_conditions[i[s]],d=s<t.length&&t[s].log,h="undefined"===typeof a;l[s]={texName:n[s],init:h?c:a.initialConditions[i[s]].value,log:h?d:a.initialConditions[i[s]].logSlider,min:h?0:a.initialConditions[i[s]].min,max:h?50:a.initialConditions[i[s]].max},this.model.initial_conditions[i[s]]=l[s].init}for(var u=new Array(o.length),f=0;f<o.length;f++){var m=f<r.length?r[f].fr:this.model.elem_reactions[f].forward_rate,g=f<r.length?r[f].br:this.model.elem_reactions[f].backward_rate,b=f<r.length&&r[f].log_fr,w=f<r.length&&r[f].log_br,R="undefined"===typeof a||"undefined"===typeof a.rates;u[f]={texName:o[f],fr:R?m:a.rates[f].forwardRate,br:R?g:a.rates[f].backwardRate,log_fr:R?b:a.rates[f].forwardRateLogSlider,log_br:R?w:a.rates[f].backwardRateLogSlider,min_fr:R?0:a.rates[f].forwardRateMin,max_fr:R?10:a.rates[f].forwardRateMax,min_br:R?0:a.rates[f].backwardRateMin,max_br:R?10:a.rates[f].forwardRateMax},this.model.elem_reactions[f].forward_rate=u[f].fr,this.model.elem_reactions[f].backward_rate=u[f].br}this.model.buildFunc();var x=this.simulModel(!this.state.cbNonZero);this.setState({initData:l,ratesData:u,figure:x,texEquation:this.state.cbNonZero?this.model.diffEquations:this.model.diffEquationsFRates,texModel:this.state.cbNonZero?this.model.latexModel:this.model.latexModelFRates})}else alert("Scheme is empty!")}},{key:"sliderLogToggledCallback",value:function(a,e){var t=this.state.initData,r=this.state.ratesData;switch(a){case"init":t[e].log=!t[e].log;break;case"fr":r[e].log_fr=!r[e].log_fr;break;case"br":r[e].log_br=!r[e].log_br}this.setState({initData:t,ratesData:r})}},{key:"sliderValueChanged",value:function(a,e,t){var r=parseFloat(t),i=this.state.initData,n=this.state.ratesData;switch(a){case"init":var o=this.model.getCompartments();this.model.initial_conditions[o[e]]=r,i[e].init=r;break;case"fr":this.model.elem_reactions[e].forward_rate=r,n[e].fr=r;break;case"br":this.model.elem_reactions[e].backward_rate=r,n[e].br=r}var l=this.simulModel(!this.state.cbNonZero);this.setState({figure:l,initData:i,ratesData:n})}},{key:"modelChanged",value:function(a,e){null!==e&&(this.state.schemeText=e.scheme,this.state.cbNonZero=e.nonZeroBackwardRates,this.modelSubmitted(e))}},{key:"cbNonZero_checkedChanged",value:function(a){var e=this.simulModel(!a.target.checked);this.setState({texEquation:a.target.checked?this.model.diffEquations:this.model.diffEquationsFRates,texModel:a.target.checked?this.model.latexModel:this.model.latexModelFRates,cbNonZero:a.target.checked,figure:e})}},{key:"render",value:function(){var a=this;return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("p",{children:"Compartmental model simulator"}),Object(r.jsxs)(M.a,{container:!0,spacing:1,alignItems:"column",direction:"row",children:[Object(r.jsxs)(M.a,{item:!0,xs:!0,children:[Object(r.jsx)(X.a,{options:z.sort((function(a,e){return-e.class.localeCompare(a.class)})),groupBy:function(a){return a.class},getOptionLabel:function(a){return a.name},onChange:this.modelChanged,renderInput:function(a){return Object(r.jsx)(H.a,Object(s.a)(Object(s.a)({},a),{},{label:"Kinetics models",variant:"outlined"}))}}),Object(r.jsx)(I,{schemeText:this.state.schemeText,modelSubmitCallback:this.modelSubmitted,textChangedCallback:this.textChangedCallback}),Object(r.jsx)(P.a,{control:Object(r.jsx)(q.a,{color:"secondary",checked:this.state.cbNonZero,onChange:this.cbNonZero_checkedChanged,name:"cbNonZero"}),label:"Non-zero backwards rates"}),Object(r.jsx)(B.BlockMath,{math:"".concat(this.state.texModel," "),errorColor:"#cc0000"}),"  ",Object(r.jsx)(B.BlockMath,{math:"".concat(this.state.texEquation," "),errorColor:"#cc0000"}),"  ",Object(r.jsx)(E,{data:this.state.initData,sliderChangedCallback:this.sliderValueChanged,sliderLogToggledCallback:this.sliderLogToggledCallback}),Object(r.jsx)(T,{data:this.state.ratesData,sliderChangedCallback:this.sliderValueChanged,sliderLogToggledCallback:this.sliderLogToggledCallback,disabled:!this.state.cbNonZero}),Object(r.jsx)(y.a,{selected:"linear"!==this.state.figure.layout.xaxis.type,onChange:function(){var e=a.state.figure;e.layout.xaxis.type="linear"===e.layout.xaxis.type?"log":"linear",e.revision+=1,a.setState({figure:e})},children:"Log x"}),Object(r.jsx)(y.a,{selected:"linear"!==this.state.figure.layout.yaxis.type,onChange:function(){var e=a.state.figure;e.layout.yaxis.type="linear"===e.layout.yaxis.type?"log":"linear",e.revision+=1,a.setState({figure:e})},children:"Log y"})]}),Object(r.jsx)(M.a,{item:!0,xs:!0,children:Object(r.jsx)(K,{data:this.state.figure.data,frames:this.state.figure.frames,config:this.state.figure.config,layout:this.state.figure.layout,revision:this.state.figure.revision})})]})]})}}]),t}(n.a.Component),G=function(a){a&&a instanceof Function&&t.e(3).then(t.bind(null,169)).then((function(e){var t=e.getCLS,r=e.getFID,i=e.getFCP,n=e.getLCP,o=e.getTTFB;t(a),r(a),i(a),n(a),o(a)}))};l.a.render(Object(r.jsx)(n.a.StrictMode,{children:Object(r.jsx)(J,{})}),document.getElementById("root")),G()},55:function(a,e,t){},89:function(a,e,t){},95:function(a,e,t){var r=t(96)("rk45");e.System=function(){this.x0=null,this.fn=null,this.newX=null,this.h=.1,this.tol=5e-7,this.start=0,this.stop=1,this.R=null,this.delta=null,this.count=0,this.maxCount=5e3,this.status={success:!1,state:"init",message:null},this.result=null},e.System.prototype={setInitX:function(a){return this.x0=a},setFn:function(a){return this.fn=a},setStart:function(a){return this.start=a},setStop:function(a){return this.stop=a},setH:function(a){return this.h=a},setTol:function(a){return this.tol=a},setMaxCount:function(a){return this.maxCount=a},getStatus:function(){return this.status},checkSetUp:function(){return this.start>=this.stop?(this.status.state="error",this.start==this.stop?this.status.message="Stop time same as start time.":this.status.message="Stop time is less than start time.",this.status.state):this.h<=0?(this.status.state="error",0==this.h?this.status.message="h is zero but must be a positive number.":this.status.message="h is less than zero but must be a positive number.",this.status.state):"ok"},computeK:function(a){for(var e=a,t=this.newX.slice(),r=this.x0.length,i=new Array(r),n=this.fn(e,t),o=0;o<r;o++)i[o]=new Array(6),i[o][0]=this.h*n[o];e=a+this.h/4;for(o=0;o<r;o++)t[o]=this.newX[o]+i[o][0]/4;n=this.fn(e,t);for(o=0;o<r;o++)i[o][1]=this.h*n[o];e=a+3*this.h/8;for(o=0;o<r;o++)t[o]=this.newX[o]+(3*i[o][0]+9*i[o][1])/32;n=this.fn(e,t);for(o=0;o<r;o++)i[o][2]=this.h*n[o];e=a+12*this.h/13;for(o=0;o<r;o++)t[o]=this.newX[o]+(1932*i[o][0]-7200*i[o][1]+7296*i[o][2])/2197;n=this.fn(e,t);for(o=0;o<r;o++)i[o][3]=this.h*n[o];e=a+this.h;for(o=0;o<r;o++)t[o]=this.newX[o]+439*i[o][0]/216-8*i[o][1]+3680*i[o][2]/513-845*i[o][3]/4104;n=this.fn(e,t);for(o=0;o<r;o++)i[o][4]=this.h*n[o];e=a+this.h/2;for(o=0;o<r;o++)t[o]=this.newX[o]-8*i[o][0]/27+2*i[o][1]-3544*i[o][2]/2565+1859*i[o][3]/4104-11*i[o][4]/40;n=this.fn(e,t);for(o=0;o<r;o++)i[o][5]=this.h*n[o];return i},solve:function(){if("ok"==this.checkSetUp()){var a=this.x0.length,e=this.start;this.newX=this.x0,this.R=new Array(a),this.delta=new Array(a),this.count=0;var t=new Array;t.push(e);for(var i=new Array(a),n=0;n<a;n++)i[n]=new Array,i[n].push(this.newX[n]);for(;e<this.stop;){r("t: "+e+", newX: "+this.newX);var o=this.computeK(e);for(n=0;n<o.length;n++)r("k["+n+"]: "+o[n]);for(n=0;n<a;n++)this.R[n]=Math.abs(o[n][0]/360-128*o[n][2]/4275-2197*o[n][3]/75240+o[n][4]/50+2*o[n][5]/55),this.R[n]=this.R[n]/this.h,this.delta[n]=.84*Math.pow(this.tol/this.R[n],.25);if(r("delta: "+this.delta+"; min: "+Math.min.apply(null,this.delta)),Math.max.apply(null,this.R)<=this.tol){r("Good to compute!"),e+=this.h,t.push(e);for(n=0;n<a;n++)this.newX[n]=this.newX[n]+(25*o[n][0]/216+1408*o[n][2]/2565+2197*o[n][3]/4104-o[n][4]/5),i[n].push(this.newX[n])}else r("Need to adjust step size, max R: "+Math.max.apply(null,this.R)),r("Scale factor: "+Math.min.apply(null,this.delta));if(this.h=this.h*Math.min.apply(null,this.delta),this.h>=this.stop-e&&(this.h=this.stop-e),this.count++>this.maxCount)break}this.count++>this.maxCount?(this.status.success=!1,this.status.state="error",this.status.message="Iteration count exceeded MAX count ("+this.maxCount+")",this.result={xVals:[],yVals:[]}):e>=this.stop&&(this.status.success=!0,this.status.state="complete",this.status.message="Integration completed sucessfully.",this.result={xVals:t,yVals:i})}}}}},[[109,1,2]]]);
//# sourceMappingURL=main.d39c457b.chunk.js.map